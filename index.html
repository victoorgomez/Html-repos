<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wrapped 2026 Ultra Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #05070a; --card: #12151c; --accent: #22d3ee; }
        body { background-color: var(--bg); color: white; font-family: 'Plus Jakarta Sans', sans-serif; letter-spacing: -0.02em; }
        .glass-card { background: var(--card); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 24px; }
        .input-style { background: #1a1f26; border: 1px solid #2d353f; border-radius: 16px; padding: 14px; color: white; outline: none; }
        .btn-main { background: linear-gradient(135deg, #22d3ee 0%, #a855f7 100%); border-radius: 18px; font-weight: 800; }
        .filter-btn { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 6px 12px; font-size: 0.65rem; font-weight: 700; white-space: nowrap; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease; text-transform: uppercase; }
        .filter-btn.active-white { background: white; color: black; border-color: white; }
        .frequent-card { background: #161a21; border-radius: 24px; padding: 20px; margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between; position: relative; overflow: hidden; }
        .city-accent { position: absolute; left: 0; top: 0; bottom: 0; width: 6px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Wrapped 2026">
<link rel="apple-touch-icon" href="https://emojicdn.elk.sh/ğŸš‡">
</head>
<body class="p-6 pb-32 max-w-lg mx-auto">

    <header class="text-center mt-4 mb-8">
        <h1 class="text-4xl font-extrabold tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-purple-500 italic">2026 TRACKER</h1>
        <p class="text-gray-500 text-[9px] font-bold uppercase tracking-[0.3em] mt-2">Personal Transit Analytics</p>
    </header>

    <div class="glass-card p-6 mb-8 shadow-2xl border-white/10">
        <div class="space-y-4">
            <select id="tipo" class="input-style w-full font-bold">
                <option value="ğŸš‡ Metro">ğŸš‡ METRO</option>
                <option value="ğŸšŒ Bus">ğŸšŒ BUS</option>
                <option value="ğŸš† CercanÃ­as">ğŸš† CERCANÃAS</option>
                <option value="âœˆï¸ AviÃ³n">âœˆï¸ AVIÃ“N</option>
                <option value="ğŸš„ Tren">ğŸš„ TREN</option>
                <option value="ğŸš‹ TranvÃ­a">ğŸš‹ TRANVÃA</option>
                <option value="â›´ï¸ Ferry">â›´ï¸ FERRY</option>
                <option value="ğŸš  Funicular">ğŸš  FUNICULAR</option>
                <option value="ğŸ›¥ï¸ Barco">ğŸ›¥ï¸ BARCO</option>
                <option value="ğŸš¡ TelefÃ©rico">ğŸš¡ TELEFÃ‰RICO</option>
            </select>
            <div class="flex gap-3">
                <input type="text" id="ciudad" placeholder="CIUDAD" class="input-style w-1/2 uppercase font-bold text-xs tracking-widest">
                <input type="text" id="linea" placeholder="LÃNEA" class="input-style w-1/2 uppercase font-bold text-xs tracking-widest">
            </div>
            <button onclick="guardarViaje(); hapticFeedback(50);" class="btn-main w-full py-4 text-black text-xs uppercase tracking-widest shadow-lg shadow-purple-500/20">Registrar Viaje</button>
        </div>
    </div>

    <section class="mb-8 space-y-4">
        <div class="flex justify-between items-end px-1">
            <h2 class="text-xl font-extrabold">Filtros</h2>
            <button onclick="resetFilters()" class="text-[10px] font-bold text-cyan-400 uppercase">Limpiar</button>
        </div>
        
        <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1" id="filterTransporte"></div>
        <div class="flex gap-2 overflow-x-auto no-scrollbar pb-2" id="filterCiudad"></div>
    </section>

    <div id="frecuentes" class="space-y-3"></div>

    <div class="fixed bottom-0 left-0 w-full p-6 bg-gradient-to-t from-black via-black to-transparent">
        <button onclick="exportarCSV()" class="w-full bg-white/5 border border-white/10 py-4 rounded-2xl text-[10px] font-bold uppercase tracking-widest backdrop-blur-xl">Descargar Backup .CSV</button>
    </div>

    <script>
        let viajes = JSON.parse(localStorage.getItem('viajes2026')) || [];
        let filterT = 'all';
        let filterC = 'all';

        const transportesDisponibles = ["ğŸš‡ Metro", "ğŸšŒ Bus", "ğŸš† CercanÃ­as", "âœˆï¸ AviÃ³n", "ğŸš„ Tren", "ğŸš‹ TranvÃ­a", "â›´ï¸ Ferry", "ğŸš  Funicular", "ğŸ›¥ï¸ Barco", "ğŸš¡ TelefÃ©rico"];

        function hapticFeedback(ms) {
            if (window.navigator && window.navigator.vibrate) {
                window.navigator.vibrate(ms);
            }
        }

        function getColorForCity(city) {
            let hash = 0;
            for (let i = 0; i < city.length; i++) hash = city.charCodeAt(i) + ((hash << 4) - hash);
            return `hsl(${Math.abs(hash) % 360}, 70%, 60%)`;
        }

        function guardarViaje(c, l, t) {
            const ciudad = c || document.getElementById('ciudad').value;
            const linea = l || document.getElementById('linea').value;
            const tipo = t || document.getElementById('tipo').value;
            if(!ciudad || !linea) return;
            viajes.unshift({ id: Date.now(), tipo, ciudad: ciudad.toUpperCase().trim(), linea: linea.toUpperCase().trim(), fecha: new Date().toLocaleString() });
            save();
            if(!c) { document.getElementById('ciudad').value = ""; document.getElementById('linea').value = ""; }
        }

        function removeOne(c, l, t) {
            const i = viajes.findIndex(v => v.ciudad === c && v.linea === l && v.tipo === t);
            if (i > -1) { viajes.splice(i, 1); save(); }
        }

        function setFilter(category, val) {
            if(category === 'transporte') filterT = val;
            else filterC = val;
            actualizarUI();
        }

        function resetFilters() { filterT = 'all'; filterC = 'all'; actualizarUI(); }

        function save() { localStorage.setItem('viajes2026', JSON.stringify(viajes)); actualizarUI(); }

        function actualizarUI() {
            // Render Filtros Transporte (Unificados a MayÃºsculas)
            const fT = document.getElementById('filterTransporte');
            fT.innerHTML = `<button onclick="setFilter('transporte', 'all')" class="filter-btn ${filterT==='all'?'active-white':''}">TODOS</button>` + 
                transportesDisponibles.map(t => `<button onclick="setFilter('transporte', '${t}')" class="filter-btn ${filterT===t?'active-white':''}"> ${t.split(' ')[1].toUpperCase()} </button>`).join('');

            // Render Filtros Ciudades con Color DinÃ¡mico al Activar
            const uniqueCiudades = [...new Set(viajes.map(v => v.ciudad))].sort();
            const fC = document.getElementById('filterCiudad');
            fC.innerHTML = `<button onclick="setFilter('ciudad', 'all')" class="filter-btn ${filterC==='all'?'active-white':''}">TODAS LAS CIUDADES</button>` + 
                uniqueCiudades.map(c => {
                    const cColor = getColorForCity(c);
                    const isActive = filterC === c;
                    return `<button onclick="setFilter('ciudad', '${c}')" class="filter-btn" style="${isActive ? `background: ${cColor}; color: black; border-color: ${cColor};` : ''}"> ${c} </button>`;
                }).join('');

            let data = viajes;
            if(filterT !== 'all') data = data.filter(v => v.tipo === filterT);
            if(filterC !== 'all') data = data.filter(v => v.ciudad === filterC);

            const grupos = {};
            data.forEach(v => {
                const k = `${v.tipo}|${v.ciudad}|${v.linea}`;
                if (!grupos[k]) grupos[k] = { ...v, count: 0 };
                grupos[k].count++;
            });

            document.getElementById('frecuentes').innerHTML = Object.values(grupos).sort((a,b) => b.count - a.count).map(g => {
                const cityColor = getColorForCity(g.ciudad);
                return `
                <div class="frequent-card">
                    <div class="city-accent" style="background: ${cityColor}"></div>
                    <div class="flex-1 ml-2">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-sm opacity-80 uppercase font-bold">${g.tipo}</span>
                            <span class="text-[10px] font-black px-2 py-0.5 rounded-full" style="background: ${cityColor}33; color: ${cityColor}">${g.count}X</span>
                        </div>
                        <div class="text-2xl font-black text-white tracking-tighter italic leading-none">${g.linea}</div>
                        <div class="text-[11px] font-extrabold tracking-[0.15em] mt-1 opacity-60 uppercase" style="color: ${cityColor}">${g.ciudad}</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="removeOne('${g.ciudad}','${g.linea}','${g.tipo}'); hapticFeedback(30);" 
                                class="w-12 h-12 rounded-2xl bg-red-500/10 border border-red-500/20 flex items-center justify-center text-red-500 active:scale-90 transition-all">
                            <span class="text-2xl mt-[-4px] font-light">âˆ’</span>
                        </button>
                        <button onclick="guardarViaje('${g.ciudad}','${g.linea}','${g.tipo}'); hapticFeedback(50);" 
                                class="w-12 h-12 rounded-2xl flex items-center justify-center text-black active:scale-90 transition-all shadow-lg" 
                                style="background: ${cityColor}; box-shadow: 0 4px 15px ${cityColor}44;">
                            <span class="text-2xl mt-[-2px] font-light">+</span>
                        </button>
                    </div>
                </div>`;
            }).join('') || '<div class="text-center py-20 text-gray-700 font-bold uppercase text-xs">No hay resultados</div>';
        }

        function exportarCSV() {
            let csv = "Tipo,Ciudad,Linea,Fecha\n" + viajes.map(v => `"${v.tipo}","${v.ciudad}","${v.linea}","${v.fecha}"`).join("\n");
            let blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            let link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "viajes_2026_pro.csv";
            link.click();
        }

        actualizarUI();
    </script>
</body>
</html>
